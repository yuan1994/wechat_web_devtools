'use strict';var _exports;function init(){const a=require('../../lib/react.js'),b=require('../../cssStr/cssStr.js'),c=require('../../stores/windowStores.js'),d=require('../../stores/projectStores.js');require('../../actions/windowActions.js');const f=require('../../actions/webviewActions.js'),g=2,h=3,i=4,j=' ',k=a.createClass({displayName:'Music',getInitialState:function(){return{showPlayer:!1,musicState:1,title:j}},_initMusic:function(){let l=document.createElement('audio');document.body.appendChild(l),this.audio=l,l.addEventListener('play',()=>{this.setState({musicState:g}),f.postMessageToAS({eventName:'onMusicPlay',type:'ON_MUSIC_EVENT',data:{dataUrl:l.src}})}),l.addEventListener('pause',()=>{this.audio&&!this.audio.ended&&(!this.audio.error&&this.setState({musicState:h}),f.postMessageToAS({eventName:'onMusicPause',type:'ON_MUSIC_EVENT',data:{dataUrl:l.src}}))}),l.addEventListener('ended',()=>{this.setState({musicState:i}),f.postMessageToAS({eventName:'onMusicEnd',type:'ON_MUSIC_EVENT',data:{dataUrl:l.src}})}),l.addEventListener('error',m=>{this.setState({musicState:5}),f.postMessageToAS({eventName:'onMusicError',type:'ON_MUSIC_EVENT',data:{dataUrl:l.src,errMsg:'Error: '+l.error.code}})})},_play:function(l){this.audio||this._initMusic();let m=this.audio;l.dataUrl&&l.dataUrl!==m.src?(m.src=l.dataUrl,m.play(),m.currentTime=0):m.src&&m.play(),this.setState({title:l.title||j})},_resume:function(l){let m=this.audio;m.paused&&m.play()},_pause:function(l){let m=this.audio;m.paused||m.pause()},_seek:function(l){let m=this.audio;m.paused||(m.currentTime=1*l.position)},_stop:function(){this.audio&&(this.audio.remove(),this.audio=void 0),this.setState({musicState:i})},_getMusicPlayState:function(l){let n,m=this.audio;if(!m)n={status:2};else try{n={dataUrl:m.src,duration:Math.floor(m.duration),currentPosition:Math.floor(m.currentTime),status:m.paused?0:1,downloadPercent:Math.round(100*m.buffered.end(0)/m.duration)}}catch(o){n={status:2}}return l&&l(n),n},_operateMusicPlayer:function(l){'play'==l.operationType?(this._play(l),this.setState({showPlayer:!0})):'resume'==l.operationType?this._resume(l):'pause'==l.operationType?this._pause(l):'seek'==l.operationType?this._seek(l):'stop'==l.operationType&&this._stop(l)},componentDidMount:function(){c.on('GET_MUSIC_PLAY_STATE',this._getMusicPlayState),c.on('BODY_CLICK',this._bodyClick),c.on('OPERATE_MUSIC_PLAY',this._operateMusicPlayer),d.on('RESTART_PROJECT',this._stop),d.on('CLOSE_PROJECT',this._stop)},componentWillUnmount:function(){c.removeListener('GET_MUSIC_PLAY_STATE',this._getMusicPlayState),c.removeListener('BODY_CLICK',this._bodyClick),c.removeListener('OPERATE_MUSIC_PLAY',this._operateMusicPlayer),d.removeListener('RESTART_PROJECT',this._stop),d.removeListener('CLOSE_PROJECT',this._stop),this.audio&&this.audio.remove()},_bodyClick:function(l){this.setState({showPlayer:!1})},stop:function(l){this._stop()},_showOrHide:function(l){this.setState({showPlayer:!this.state.showPlayer}),l.stopPropagation(),l.preventDefault()},_playOrPause:function(l){this.state.musicState==h?this._resume():this._pause(),l.stopPropagation(),l.preventDefault()},render:function(){let l=this.state.musicState==g||this.state.musicState==h?{}:b.displayNone,m=this.state.showPlayer?{}:b.displayNone,n=this.state.musicState==h?{}:b.displayNone,o=this.state.musicState==g?{}:b.displayNone;return a.createElement('div',{style:l,title:`音乐控件`,onClick:this._showOrHide,className:'sidebar-item'},a.createElement('i',{className:'sidebar-item-icon  sidebar-item-icon-music'}),a.createElement('label',{className:'sidebar-item-label'},'\u97F3\u4E50'),a.createElement('div',{className:'music-card',style:m,onClick:this._playOrPause},a.createElement('div',{className:'music-card-main'},a.createElement('p',{className:'music-card-status'},'\u6B63\u5728\u64AD\u653E'),a.createElement('p',{className:'music-card-name'},this.state.title)),a.createElement('div',{className:'music-card-opr'},a.createElement('i',{className:'music-card-play-icon',style:n}),a.createElement('i',{className:'music-card-pause-icon',style:o}))))}});_exports=k}init(),module.exports=_exports;