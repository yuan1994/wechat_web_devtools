'use strict';var _exports;function init(){function a(m){j.showTipsMsg({msg:m,type:'error'})}const b=require('../../lib/react.js');require('../../utils/tools.js');const c=require('../../cssStr/cssStr.js');require('path');const d=require('../../utils/newReport.js'),e=require('../../config/urlConfig.js'),f=require('../../common/request/request.js');require('../../stores/webviewStores.js');const g=require('../../common/log/log.js'),h=require('glob'),i=require('../../config/errcodeConfig.js'),j=require('../../actions/windowActions.js');require('../../stores/projectStores.js');const k=require('../../actions/projectActions.js'),l=b.createClass({displayName:'Createstep',getInitialState:function(){return{projectpath:'',appid:'',appname:'',error:'',saveBtnDisable:!0,showQuickStart:!1,checked:!0,showLoading:!1,isTourist:!1}},chooseDir:function(){let m=document.createElement('input');m.setAttribute('type','file'),m.setAttribute('nwdirectory',!0),m.style.display='none',global.contentDocumentBody.appendChild(m),m.addEventListener('change',n=>{h('*',{cwd:m.value},(o,p)=>{let q=0===p.length;this.setState({projectpath:m.value,showQuickStart:q})}),global.contentDocumentBody.removeChild(m)}),m.addEventListener('cancel',n=>{global.contentDocumentBody.removeChild(m)}),m.click()},editAppid:function(m){let n=m.target,o=n.value;this.setState({appid:o})},editAppname:function(m){let n=m.target,o=n.value;this.setState({appname:o})},tourist:function(){this.setState({isTourist:!this.state.isTourist})},addProject:function(){let m=this.state.projectpath,n=this.state.isTourist,o=n?'touristappid':this.state.appid,p=encodeURIComponent(this.state.appname);if(!o)return void a(`请填写 appid `);if(!p)return void a(`请填写 项目名称 `);if(!m)return void a(`请选择 项目目录 `);let q=`${o}_${p}`,r=this.props.projectLists.find(u=>{return u.projectid===q});if(r)return void this.setState({projectpath:'',appid:'',appname:'',saveBtnDisable:!0,error:`已存在 ${o} ${decodeURIComponent(r.appname)} 项目，请重新输入`});let s=this.state.showQuickStart&&this.state.checked;this.setState({showLoading:!0});let t={projectpath:'',appid:'',appname:'',error:'',saveBtnDisable:!0,showLoading:!1,isTourist:!1};if(n){let u={appid:o,appname:p,projectpath:m,projectid:q,app_head_img:'',is_admin:!1,isTourist:!0,urlCheck:!1};k.add(u,s),d(`project_createsuc`,o),this.setState(t),this.props.goMain(u),f({url:`${e.touristCreateURL}?appid=${o}`,needToken:1},()=>{})}else f({url:`${e.createWeappURL}?appid=${o}`,needToken:1},(u,v,w)=>{if(u)g.error(`createstep.js create  ${u.toString()}`),this.setState({showLoading:!1}),a(u.toString());else{this.setState({showLoading:!1}),g.info(`createstep.js create  ${w}`);let x=JSON.parse(w),y=x.baseresponse,z=y?parseInt(y.errcode):0;if(z===i.DEV_App_Not_Band)return a('\u5F53\u524D\u5F00\u53D1\u8005\u672A\u7ED1\u5B9A\u6B64 appid \uFF0C\u8BF7\u5230 mp \u540E\u53F0\u64CD\u4F5C\u540E\u91CD\u8BD5'),nw.Shell.openExternal('https://mp.weixin.qq.com/'),void g.error(`createstep.js create project error ${z}`);if(0===z){let A=x.app_head_img?`${x.app_head_img}/0`:'',B=x.app_nickname||p;return r={appid:o,appname:p,projectpath:m,projectid:q,app_head_img:A,app_nickname:B,is_admin:x.is_admin,isTourist:!1,urlCheck:!0},k.add(r,s),d(`project_createsuc`,o),this.setState(t),void this.props.goMain(r)}a(w||'\u7CFB\u7EDF\u9519\u8BEF')}})},changeCheckbox:function(m){let n=m.target.checked;this.setState({checked:n})},render:function(){let m=this.props.show?{}:c.displayNone,n=this.state.showQuickStart?{}:c.visibilityHidden,o=this.props.createBack,p=this.state.isTourist,q=p?'\u65E0 AppID \u90E8\u5206\u529F\u80FD\u53D7\u9650':this.state.appid,r=p?'':'\u586B\u5199\u5C0F\u7A0B\u5E8FAppID ',s=p?'\u8FD4\u56DE\u586B\u5199\u5C0F\u7A0B\u5E8FAppID':'\u65E0 AppID ',t=this.state.showLoading?'create-form-button-primary detail-upload-dialog-button-primary-loading':'create-form-button-primary';return b.createElement('div',{className:'create-step2',style:m},b.createElement('div',{className:'create-toolbar app-drag'},b.createElement('a',{onClick:o,href:'javascript:;',className:'create-toolbar-close app-no-drag'},b.createElement('i',{className:'create-toolbar-back-icon'}),b.createElement('span',null,'\u8FD4\u56DE'))),b.createElement('div',{className:'create-body'},b.createElement('div',{className:'create-name'},'\u6DFB\u52A0\u9879\u76EE'),b.createElement('div',{className:'create-form'},b.createElement('div',{className:'create-form-item'},b.createElement('label',{htmlFor:'',className:'create-form-label'},'AppID'),b.createElement('div',{className:'create-form-input-box'},b.createElement('input',{value:q,onChange:this.editAppid,type:'text',className:'create-form-input',disabled:p}),b.createElement('p',{style:this.state.error?c.displayNone:{},className:'create-form-tips'},r,b.createElement('a',{onClick:this.tourist,href:'javascript:;',className:'create-form-tourist'},s)),b.createElement('p',{style:this.state.error?{}:c.displayNone,className:'create-form-tips-warn'},this.state.error))),b.createElement('div',{className:'create-form-item'},b.createElement('label',{htmlFor:'',className:'create-form-label'},'\u9879\u76EE\u540D\u79F0'),b.createElement('div',{className:'create-form-input-box'},b.createElement('input',{value:this.state.appname,onChange:this.editAppname,type:'text',className:'create-form-input'}))),b.createElement('div',{className:'create-form-item'},b.createElement('label',{htmlFor:'',className:'create-form-label'},'\u9879\u76EE\u76EE\u5F55'),b.createElement('div',{onClick:this.chooseDir,className:'create-form-input-box'},b.createElement('input',{value:this.state.projectpath,disabled:'true',type:'text',className:'create-form-input create-form-input-with-pointer'}),b.createElement('p',{className:'create-form-tips'})),b.createElement('div',{className:'create-form-extra'},b.createElement('a',{href:'javascript:;',onClick:this.chooseDir,className:'create-form-extra-button'},'\u9009\u62E9'))),b.createElement('div',{style:n,className:'create-quick-checkbox'},b.createElement('input',{id:'quick-checkbox',onChange:this.changeCheckbox,checked:this.state.checked,type:'checkbox'}),b.createElement('label',{htmlFor:'quick-checkbox'},'\u5728\u5F53\u524D\u76EE\u5F55\u4E2D\u521B\u5EFA quick start \u9879\u76EE'))),b.createElement('div',{className:'create-form-footer'},b.createElement('a',{href:'javascript:;',className:'create-form-button-default',onClick:o},'\u53D6\u6D88'),b.createElement('a',{onClick:this.addProject,href:'javascript:;',className:t},'\u6DFB\u52A0\u9879\u76EE'))))}});_exports=l}init(),module.exports=_exports;