'use strict';var _exports;function init(){const a=require('../../lib/react.js');require('../../cssStr/cssStr.js');const b=require('../../actions/webviewActions.js'),c=require('../../stores/windowStores.js'),d=require('../../actions/windowActions.js'),e=require('./urlcomplete.js');var f;const g=a.createClass({displayName:'Urlbar',getInitialState:function(){return{webviewID:0,url:'',autoIndex:0,autocomplete:[]}},loadUrl:function(h){h=h||this.getCurrentUrl(),h=h.trim();let i=this.state.webviewID;'about:blank'===h?b.setWebviewAction(i,{act:'reLoad'}):(d.setAutoComplete(h),b.getA8keyWebview(i,{url:h,isSync:!0,from:'urlbar'})),this.setState({autocomplete:[]})},getAutoComplete:function(h){let i=h.trim(),j=/^http:\/\//.test(i),k=/^https:\/\//.test(i),l=[],m=c.getAutoComplete();return m.forEach(n=>{4<i.length&&(j||k?!/^https?:\/\//.test(n)&&(n=j?`http://${n}`:`https://${n}`):n=n.replace(/^https?:\/\//,'')),0===n.indexOf(i)&&-1===l.indexOf(n)&&l.push(n)}),l},handleKeyUp:function(h){let i=h.target,j=h.keyCode;if(this.state.webviewID,13===j)i.selectionStart=i.value.length,this.loadUrl();else if(40===j||38===j){let k=this.state.autoIndex,l=this.getCurrentUrl();if(38===j)k--,k=0>=k?0:k;else{let m=this.state.autocomplete.length;k++,k=k>=m?m-1:k}l=0<=k?this.state.autocomplete[k]:l,this.setState({autoIndex:k,url:l},()=>{setTimeout(()=>{i.selectionStart=i.value.length},17)})}else 8===j&&(i.dataset.changeFrom='backspace')},handleChange:function(h){let i=h.target,j=i.value,k='backspace'===i.dataset.changeFrom,l=this.getAutoComplete(j);if(this.state.webviewID,k)return i.dataset.changeFrom='',void this.setState({url:j,autocomplete:l});let m=l[0]&&!k?l[0]:j;this.setState({url:m,autocomplete:l},()=>{let n=m.indexOf(j)+j.length;n===m.length||(this.refs.urlinput.selectionStart=n,this.refs.urlinput.selectionEnd=m.length)})},handleBlur:function(){f=setTimeout(()=>{this.setState({autocomplete:[]})},100)},handleFocus:function(){let h=this.getCurrentUrl(),i=this.getAutoComplete(h);this.setState({autocomplete:i})},handleOnClick:function(){this.loadUrl()},getCurrentUrl:function(){return this.state.url},autoClick:function(h){clearTimeout(f);let i=h.currentTarget,j=i.dataset,k=j.index,l=this.state.autocomplete[k];this.setState({url:l,autocomplete:[]}),this.loadUrl(l)},_changeWebviewID:function(h){this.setState({webviewID:h})},_changeUrl:function(h){0===h.indexOf('chrome-extension:')&&(h='about:blank'),this.setState({url:h})},_focusAddressbar:function(h){this.refs.urlinput.select(),this.refs.urlinput.focus()},componentDidMount:function(){c.on('CHANGE_WEBVIEW_URL',this._changeUrl),c.on('FOCUS_ADDRESSBAR',this._focusAddressbar)},componentWillUnmount:function(){c.removeListener('CHANGE_WEBVIEW_URL',this._changeUrl),c.removeListener('FOCUS_ADDRESSBAR',this._focusAddressbar)},render:function(){this.state.webviewID;let h=this.state.url;return a.createElement('div',{className:'toolbar-location'},a.createElement('input',{className:'toolbar-location-input',type:'text',ref:'urlinput',onKeyDown:this.handleKeyUp,onBlur:this.handleBlur,onFocus:this.handleFocus,value:h,onChange:this.handleChange}),a.createElement('div',{className:'toolbar-location-refresh'},a.createElement('i',{className:'toolbar-location-refresh-icon'})),a.createElement('div',{className:'toolbar-location-history'},a.createElement('i',{className:'toolbar-location-history-icon'})),a.createElement(e,{autoClick:this.autoClick,autocomplete:this.state.autocomplete,autoIndex:this.state.autoIndex}))}});_exports=g}init(),module.exports=_exports;