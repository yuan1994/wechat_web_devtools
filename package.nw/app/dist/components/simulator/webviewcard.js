'use strict';var _exports;function init(){const a=require('../../lib/react.js'),b=require('../../cssStr/cssStr.js'),c=require('../../stores/webviewStores.js'),d=require('../../actions/webviewActions.js');require('../../actions/leftviewActions.js'),require('../../stores/leftviewStores.js');const e=require('../../common/log/log.js'),f=require('../../common/jssdk/sdkNameTrans.js'),g=require('../../config/errcodeConfig.js'),h=a.createClass({displayName:'WebviewCard',getInitialState:function(){return{showDetails:!1}},cancel:function(){this.close();let j=this.props.cardInfo,k=j.data,l=j.webviewID,m=j.sdkName,n=j.isHavePurview;if('batchViewCard'!==m){let p={errMsg:`${f.getSdkDisplayName(m)}:cancel`};d.sendJSSDKRes(l,m,p,k.ext),d.setSdkLog(l,k,n,p,{type:'CARD_SDK'})}},close:function(j){return this.state.showDetails?void this.setState({showDetails:!1}):void this.props.closeCard()},batchAddCard:function(j){let k=j.currentTarget,l=k.dataset,m=l.index,n=this.props.cardInfo,o=n.data,p=o.args,q=n.webviewID,r=n.sdkName,s=n.isHavePurview,t=p.appId,u=this.props.cardInfo.cardData[m],v=p.card_list[m],w=[];for(let B=0;B<u.amount;B++)w.push({card_id:v.card_id,card_ext:v.card_ext,is_succ:1});const x=require('../../common/request/request.js');let y={appid:t,acceptitem_list:w,js_checinfo_url:o.ext.url},z={url:'https://mp.weixin.qq.com/debug/cgi-bin/webdebugger/acceptcarditem',body:JSON.stringify(y),method:'post',needToken:!0},A={type:'CARD_SDK'};x(z,(B,C,D)=>{if(!B){let E=JSON.parse(D),F=E.baseresponse;if(0===F.errcode){let G={errMsg:'addCard:ok',card_list:JSON.stringify(w)},H=w.map(I=>{return{cardExt:I.card_ext,cardId:I.card_id,isSuccess:!0}});d.sendJSSDKRes(q,r,G,o.ext),d.setSdkLog(q,o,s,{errMsg:'addCard:ok',cardList:H},A),this.close()}else{let G={errMsg:`addCard:fail; ${F.errmsg}`};d.sendJSSDKRes(q,r,G,o.ext),d.setSdkLog(q,o,s,G,A),this.close()}}else{e.error(`WebviewCards.js batchAddCard request error ${JSON.stringify(B)}`);let E={errMsg:`addCard:fail; ${JSON.stringify(B)}`};d.sendJSSDKRes(q,r,E,o.ext),d.setSdkLog(q,o,s,E,A),this.close()}})},chooseCard:function(j){let k=this.props.cardInfo,l=k.data,m=k.sdkName,n=k.webviewID,o=k.isHavePurview,p=j.currentTarget,q=p.dataset,r=[{card_id:q.cardid,encrypt_code:q.encryptcode}],s={errMsg:'chooseCard:ok',choose_card_info:JSON.stringify(r)};d.sendJSSDKRes(n,m,s,l.ext),d.setSdkLog(n,l,o,s,{type:'CARD_SDK'}),this.close()},formatTime:function(j){let k=new Date(1000*j);return`${k.getFullYear()}.${k.getMonth()+1}.${k.getDate()}`},cardDetail:function(j){let k=j.currentTarget,l=k.dataset,m=l.index;this.setState({showDetails:!0,cardIndex:m})},render:function(){let j=this.props.showCard?{}:b.displayNone,k=c.getOffset();delete k.dpr,j=Object.assign({},j,k);let l=this.props.cardInfo,m=l.sdkName,n=l.cardData,o=a.createElement('div',null);if('batchAddCard'===m){let p={},q=n.map((r,s)=>{if(r.errmsg)return a.createElement('div',{className:'webview-card-add-item',key:s},a.createElement('div',{className:'webview-card-add-item_top'},a.createElement('div',{className:'webview-card-add-item_details'},a.createElement('div',{className:'webview-card-add-item_name'},'cardId: ',r.card_id),a.createElement('div',{className:'webview-card-add-item_info'},a.createElement('span',{className:'webview-card-add-item_intro'},'errmsg: ',r.errmsg)))),a.createElement('div',{className:'webview-card-add-item_bottom webview-card-add-item_bottom_error'},a.createElement('div',{className:'webview-card-add-item_button'},'\u9519\u8BEF\u5361\u5238')));let t=r.card_tp_info,u=t.brand_name,v=t.title,w=t.logo_url,x=r.card_data_info;p.backgroundColor=t.color;let B,y=this.formatTime(t.begin_time),z=this.formatTime(t.end_time),A=0===x.limit_num;return B=A?a.createElement('div',{className:'webview-card-add-item_bottom webview-card-add-item_bottom_disable',style:p},a.createElement('div',{className:'webview-card-add-item_button_error'},t.limit_wording)):a.createElement('div',{'data-index':s,onClick:this.batchAddCard,className:'webview-card-add-item_bottom',style:p},a.createElement('div',{className:'webview-card-add-item_button'},t.accept_wording)),a.createElement('div',{className:'webview-card-add-item',key:s},a.createElement('div',{className:'webview-card-add-item_top'},a.createElement('div',{className:'webview-card-add-item_left'},a.createElement('img',{className:'webview-card-add-item_img',src:w})),a.createElement('div',{className:'webview-card-add-item_details'},a.createElement('div',{className:'webview-card-add-item_name'},u),a.createElement('div',{className:'webview-card-add-item_info'},a.createElement('span',{className:'webview-card-add-item_intro'},v),a.createElement('span',{className:'webview-card-add-item_num'},'X',r.amount)),a.createElement('div',{className:'webview-card-add-item_time'},y,' - ',z))),B)});o=a.createElement('div',{className:'webview-card-add',style:p},a.createElement('div',{className:'webview-card-add-header'},a.createElement('div',{className:'webview-card-add-header_button',onClick:this.cancel},' \u53D6\u6D88 '),a.createElement('div',{className:'webview-card-add-header_title'},' \u6DFB\u52A0\u5361\u5377 ')),a.createElement('div',{className:'webview-card-add-container'},q))}else if('chooseCard'===m){let p=n.available_cards,q=p.map((s,t)=>{return a.createElement('div',{onClick:this.chooseCard,key:t,'data-appid':s.app_id,'data-cardid':s.card_tp_id,'data-encryptcode':s.encrypt_code,className:'webview-card-choose-item'},a.createElement('div',{className:'webview-card-choose_m'},a.createElement('div',{className:'webview-card-choose_left'},a.createElement('img',{className:'webview-card-choose-item_img',src:s.logo_url})),a.createElement('div',{className:'webview-card-choose_details'},a.createElement('div',{className:'webview-card-choose-item_name'},s.sub_title),a.createElement('div',{className:'webview-card-choose-item_info'},s.title))))}),r;r=q.length?a.createElement('div',{className:'webview-card-choose-container',style:{height:k.height-42}},a.createElement('span',{className:'webview-card-choose-mycard'},'\u6211\u7684\u5361\u5377'),a.createElement('div',{className:'webview-card-choose-item'},q)):a.createElement('div',{className:'webview-card-choose-container',style:{height:k.height-42}},a.createElement('span',{className:'webview-card-choose-mycard webview-card-choose-mycardEmpty'},'\u6682\u65E0\u53EF\u6DFB\u52A0\u7684\u5361\u5238')),o=a.createElement('div',{className:'webview-card-choose'},a.createElement('div',{className:'webview-card-choose-header'},a.createElement('div',{className:'webview-card-choose-header_button',onClick:this.cancel},' \u53D6\u6D88 '),a.createElement('div',{className:'webview-card-choose-header_title'},' \u9009\u62E9\u5361\u5377 ')),r)}else if('batchViewCard'===m){let p=l.cardData.retData.card_array,q=l.cardData.errData,r=!!q.length,s=this.state.showDetails;if(1===p.length&&!r||s){let t=s?p[this.state.cardIndex]:p[0],u=t.card_data_info,v=this.formatTime(u.begin_time),w=this.formatTime(u.end_time),x=t.card_tp_info,y=x.brand_name,z=x.title,A=x.logo_url,B=0===x.limit_num,C={};C.backgroundColor=x.color,B?a.createElement('div',{className:'webview-card-add-item_bottom webview-card-add-item_bottom_disable'},a.createElement('div',{className:'webview-card-add-item_button_error'},x.limit_wording)):a.createElement('div',{onClick:this.batchAddCard,className:'webview-card-add-item_bottom'},a.createElement('div',{className:'webview-card-add-item_button'},x.accept_wording));let D=s?'\u8FD4\u56DE':'\u5173\u95ED';o=a.createElement('div',{className:'webview-card-open',style:C},a.createElement('div',{className:'webview-card-open-header'},a.createElement('div',{className:'webview-card-open-header_button',onClick:this.cancel},' ',D,' ')),a.createElement('div',{className:'webview-card-open-container'},a.createElement('div',{className:'webview-card-open_top'},a.createElement('img',{className:'webview-card-open-item_img',src:A})),a.createElement('div',{className:'webview-card-open_middle'},a.createElement('div',{className:'webview-card-open-name'},y),a.createElement('div',{className:'webview-card-open-intro'},z),a.createElement('div',{className:'webview-card-open-item_button',style:C},a.createElement('div',{className:'webview-card-open_buttom_wording'},'\u7ACB\u5373\u4F7F\u7528')),a.createElement('div',{className:'webview-card-open-time'},'\u6709\u6548\u671F: ',v,'-',w)),a.createElement('div',{className:'webview-card-open_bottom'},a.createElement('div',{className:'webview-card-open_detail'},'\u5151\u6362\u5377\u8BE6\u60C5'),a.createElement('div',{className:'webview-card-open_detail'},'\u516C\u4F17\u53F7'),a.createElement('div',{className:'webview-card-open_detail'},'\u5728\u7EBF\u5151\u6362'))))}else{let t=p.map((v,w)=>{let x=v.card_tp_info;return a.createElement('div',{onClick:this.cardDetail,key:w,'data-index':w,className:'webview-card-choose-item'},a.createElement('div',{className:'webview-card-choose_m'},a.createElement('div',{className:'webview-card-choose_left'},a.createElement('img',{className:'webview-card-choose-item_img',src:x.logo_url})),a.createElement('div',{className:'webview-card-choose_details'},a.createElement('div',{className:'webview-card-choose-item_name'},x.brand_name),a.createElement('div',{className:'webview-card-choose-item_info'},x.title))))}),u=q.map((v,w)=>{let x='INVALID_CODE'===g[v.errcode]?'\u9519\u8BEF\u5361\u5238 ID':'\u9519\u8BEF\u5361\u5377 code';return a.createElement('div',{key:w,className:'webview-card-choose-item'},a.createElement('div',{className:'webview-card-choose_mErr'},a.createElement('div',{className:'webview-card-choose_details'},a.createElement('div',{className:'webview-card-choose-item_error'},x),a.createElement('div',{className:'webview-card-choose-item_error'},'cardId: ',v.card_id),a.createElement('div',{className:'webview-card-choose-item_error'},'code: ',v.code))))});o=a.createElement('div',{className:'webview-card-choose'},a.createElement('div',{className:'webview-card-choose-header'},a.createElement('div',{className:'webview-card-choose-header_button',onClick:this.cancel},' \u5173\u95ED '),a.createElement('div',{className:'webview-card-choose-header_title'},' \u5361\u5238\u5217\u8868 ')),a.createElement('div',{className:'webview-card-choose-container',style:{height:k.height-42}},a.createElement('div',{className:'webview-card-choose-item'},t,u)))}}return a.createElement('div',{className:'webview-card',style:j},o)}});_exports=h}init(),module.exports=_exports;