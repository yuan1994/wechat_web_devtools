'use strict';var _exports;function init(){const a=require('path'),b=require('../lib/react.js'),c=require('./popup/popup.js'),d=require('./menubar/menubar.js'),e=require('./toolbar/toolbar.js'),f=require('./sidebar/sidebar.js'),g=require('./develop/develop.js'),h=require('./detail/detail.js');require('./setting/setting.js');const i=require('./edit/edit.js'),j=require('../weapp/utils/projectManager.js').manager,k=require('../actions/projectActions.js'),l=require('./dialog/dialog.js'),m=require('./about/about.js'),n=require('../stores/windowStores.js'),o=require('../actions/windowActions.js');require('../stores/webviewStores.js'),require('../actions/webviewActions.js');var q,r=0;const s=b.createClass({displayName:'Main',getInitialState:function(){let t=this.props.project?n.getLastShow():'debug';return{show:t,memory:0,cpu:0}},optProject:function(t){n.setLastShow(t),this.setState({show:t})},_projectWatcher:function(t,u,v,w){if(this.props.project){let A=t.watcher||'edit'===this.state.show;A&&(q&&(clearTimeout(q),r++),q=setTimeout(()=>{if(2<r)k.restart(this.props.project);else{let B=a.extname(v);if('.swp'===B)return;'.json'===B||'.js'===B||'.wxml'===B?k.restart(this.props.project):k.restart(this.props.project)}r=0,q=void 0},100))}},_openProjectFile:function(){this.optProject('edit')},_memory:function(t={}){let u=0;for(let v in this._memoryTime++,t){let w=t[v];w.privateMemory&&(u+=w.privateMemory)}u=parseInt(u/1024/1024),this._memorySum+=u,this._memoryNow=u,this._memoryPre=parseInt(this._memorySum/this._memoryTime)},_cpu:function(t={}){let u=0,v=0;for(let w in this._cpuTime++,t){let x=t[w];x.cpu&&(u+=x.cpu)}this._cpuSUm+=u,u=u.toFixed(2),v=(this._cpuSUm/this._cpuTime).toFixed(2),this._systemCpuSPAN.innerText=`内存占用 ${this._memoryNow}/${this._memoryPre} mb, CPU ${u}/${v}%`},componentDidMount:function(t){if(j.on('FILE_CHANGE',this._projectWatcher),n.on('OPEN_PROJECT_FILE',this._openProjectFile),this._memoryTime=0,this._memorySum=0,this._cpuTime=0,this._cpuSUm=0,global.appConfig.isDev){let u=this._systemCpuSPAN=document.createElement('span');u.style.cssText=`position:absolute;bottom: 0;left: 60px;margin-bottom: 10px;`,global.contentDocumentBody.appendChild(u),chrome.processes.onUpdatedWithMemory.addListener(this._memory),chrome.processes.onUpdated.addListener(this._cpu)}},componentWillUnmount:function(){j.removeListener('FILE_CHANGE',this._projectWatcher),n.removeListener('OPEN_PROJECT_FILE',this._openProjectFile),global.appConfig.isDev&&(chrome.processes.onUpdatedWithMemory.removeListener(this._memory),chrome.processes.onUpdated.removeListener(this._cpu),this._systemCpuSPAN&&this._systemCpuSPAN.remove())},showSetting:function(){o.showSetting()},render:function(){let t='',u='';return this.props.project&&(t=b.createElement(i,{show:this.state.show,project:this.props.project}),u=b.createElement(h,{project:this.props.project,optProject:this.optProject,show:this.state.show})),b.createElement('div',{className:'main'},b.createElement(d,{lastWinStatus:this.props.lastWinStatus,appQuit:this.props.appQuit,appMin:this.props.appMin,appMax:this.props.appMax,showSetting:this.showSetting,project:this.props.project}),b.createElement(e,{project:this.props.project}),b.createElement('div',{className:'body'},b.createElement(f,{show:this.state.show,project:this.props.project,optProject:this.optProject}),b.createElement(g,{show:this.state.show,optDebugger:this.optDebugger,project:this.props.project}),t,u),b.createElement(l,null),b.createElement(c,null),b.createElement(m,null))}});_exports=s}init(),module.exports=_exports;