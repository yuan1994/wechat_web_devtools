'use strict';var _exports;function init(){function a(r,s){let t=l.getUserInfo(),u=t?t.openid:'guest';return k.join(q,`${r}_${s}_${u}.data.json`)}function b(r,s,t){let u=a(r,s);j.writeFileSync(u,JSON.stringify(t),'utf8'),n.upASData(r,t)}function c(r,s){let t=a(r,s),u;try{u=JSON.parse(j.readFileSync(t,'utf8'))}catch(v){u={},b(r,s,u)}return u}function d(r,s,t){let u=r.appid,v=r.appname,w=c(u,v),x=t?'getStorageSync':'getStorage',y=r.args,z=y.key,A=w[z],B;B=void 0===A?{errMsg:`${x}:fail`}:{errMsg:`${x}:ok`,data:A.data,dataType:A.dataType},s(B)}function f(r,s,t){let u=r.appid,v=r.appname,w=c(u,v),x=t?'setStorageSync':'setStorage',y=r.args,z=y.key,A=y.data,B=y.dataType;w[z]={data:A,dataType:B};let C=m.getProjectConfig({hash:r.apphash}),D=C?C.Setting.MaxLocalstorageSize:p;JSON.stringify(w).length>1024*(1024*D)?s({errMsg:`${x}:fail exceed storage max size ${D}Mb;`},{appid:u,storage:c(u,v)}):(b(u,v,w),s({errMsg:`${x}:ok`},{appid:u,storage:w}))}function g(r,s,t){let u=r.appid,v=r.appname;b(u,v,{}),s({errMsg:t?'clearStorageSync:ok':'clearStorage:ok'},{appid:g,storage:{}})}function h(r,s,t){let u=r.appid,v=r.appname,w=c(u,v),x=r.args,y=x.key;delete w[y],b(u,v,w),s({errMsg:t?'removeStorageSync:ok':'removeStorage:ok'},{appid:u,storage:w})}function i(r,s,t){let u=r.appid,v=r.appname,w=c(u,v),x={};x.keys=Object.keys(w),x.currentSize=Math.ceil(JSON.stringify(w).length/1024);let y=m.getProjectConfig({hash:r.apphash}),z=y?y.Setting.MaxLocalstorageSize:p;x.limitSize=1024*z,x.errMsg=t?'getStorageInfoSync:ok':'getStorageInfo:ok',s(x,{appid:u,storage:w})}const j=require('fs'),k=require('path'),l=require('../../stores/windowStores.js'),m=require('../../stores/projectStores.js'),n=require('../../actions/webviewActions.js'),o=require('../../config/dirConfig.js'),p=10;var q=o.WeappStorage;_exports={getStorage:d,clearStorage:g,setStorage:f,removeStorage:h,getStorageInfo:i,getStorageSync:function(s,t){d(s,t,!0)},setStorageSync:function(s,t){f(s,t,!0)},clearStorageSync:function(s,t){g(s,t,!0)},removeStorageSync:function(s,t){h(s,t,!0)},getStorageInfoSync:function(s,t){i(s,t,!0)}}}init(),module.exports=_exports;