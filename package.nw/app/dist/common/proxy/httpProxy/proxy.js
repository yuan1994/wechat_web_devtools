const http=require("http"),async=require("async"),requestHandler=require("./lib/requestHandler"),log=require("../../log/log.js"),DEFAULT_PORT=8001,DEFAULT_HOST="localhost";var default_rule=require("./lib/rule_default");function proxyServer(a){a=a||{};var b=this,c=a.port||DEFAULT_PORT,d=a.hostname||DEFAULT_HOST,e=a.rule||default_rule;requestHandler.setRules(e),b.httpProxyServer=null,async.series([function(f){b.httpProxyServer=http.createServer(requestHandler.userRequestHandler),f(null)},function(f){b.httpProxyServer.listen(c,d),f(null)},function(f){f(null)}],function(f,g){f?log.error(`err when start proxy server : ${f}`):log.info(`Http proxy started at ${d}:${c}`)}),b.close=function(){b.httpProxyServer&&b.httpProxyServer.close(),log.info(`ProxyServer closed :${d}:${c}`)}}module.exports.proxyServer=proxyServer;