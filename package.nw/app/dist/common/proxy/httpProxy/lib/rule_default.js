var path=require("path"),fs=require("fs");module.exports={summary:function(){return"the default rule for AnyProxy which supports CORS."},shouldUseLocalResponse:function(a,b){if("OPTIONS"==a.method)return!0;var c=(a.headers.host||"")+(a.url||"");return mapConfig.map(function(d){var e=d.keyword;if(0<=c.indexOf(e))return a.anyproxy_map_local=d.local,!1}),!!a.anyproxy_map_local},dealLocalResponse:function(a,b,c){"OPTIONS"==a.method?c(200,mergeCORSHeader(a.headers),""):a.anyproxy_map_local&&fs.readFile(a.anyproxy_map_local,function(d,e){d?c(200,{},"[AnyProxy failed to load local file] "+d):c(200,{},e)})},replaceRequestProtocol:function(a,b){},replaceRequestOption:function(a,b){},replaceRequestData:function(a,b){},replaceResponseStatusCode:function(a,b,c){},replaceResponseHeader:function(a,b,c){return mergeCORSHeader(a.headers,c)},replaceServerResDataAsync:function(a,b,c,d){d(c)},pauseBeforeSendingResponse:function(a,b){},saveAllHttpResponse:function(a,b,c,d){},fetchTrafficData:function(a,b){}};function mergeCORSHeader(a,b){var c=b||{};return delete c["Access-Control-Allow-Credentials"],delete c["Access-Control-Allow-Origin"],delete c["Access-Control-Allow-Methods"],delete c["Access-Control-Allow-Headers"],c["access-control-allow-credentials"]="true",c["access-control-allow-origin"]=a.origin||a.Origin||"-___-||",c["access-control-allow-methods"]="GET, POST, PUT",c["access-control-allow-headers"]=a["access-control-request-headers"]||"-___-||",c}