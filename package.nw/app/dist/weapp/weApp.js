'use strict';var _exports={};function init(){const a=global.appConfig.isDev,{JSON_PARSE_ERROR:b,ES6_ERROR:c,JSON_FILE_ERROR:d,JSON_ENTRANCE_ERROR:f,JSON_CONTENT_ERROR:g}=require('../config/config.js'),h=require('./trans/transManager.js'),j=require('./utils/tools.js');require('async');const k=require('fs'),l=require('path'),m=require('url'),n=require('./utils/vendorManager.js');require('glob');const o=require('./utils/projectManager.js'),p=require('../config/appserviceConfig.js'),q=require('../stores/projectStores.js'),r=require('../stores/windowStores.js'),s=require('../actions/windowActions.js'),t=require('./utils/parseErr.js'),u=require('../utils/file.js');require('./tpl/errorTpl.js'),require('./tpl/appserviceErrorTpl.js');const v=l.join(__dirname,'appservice/asdebug.js');var w=k.readFileSync(v,'utf8');j.noBrowser.join(','),_exports.getAppservice=function(x,y){let z=j.getProject(x),A=m.parse(x),B=A.pathname,C=/appservice$/.test(B),D=/appservice-sdk\.js$/.test(B),E=/asdebug\.js$/.test(B),F=/ascheck\.js$/.test(B),G=/webnode\.js$/.test(B),H=/reporter-sdk\.js/.test(B),I=/app_service_engine\.js/.test(B);/\.js$/.test(B);let J=/\.js\.map$/.test(B),K=/WAService\.js/.test(B),L=/favicon\.ico$/.test(B);if(L)y(200,{},'');else if(K)y(null,{},n.getFile('WAService.js'));else if(H)y(null,{},n.getFile('reporter-sdk.js'));else if(I)y(null,{},n.getFile('app_service_engine.js'));else if(D)y(null,{},n.getFile('appservice-sdk.js'));else if(E)y(null,{},w);else if(F)y(null,{},asCheck);else if(G)y(null,{},n.getFile('webnode.js'));else if(J){let M=l.join(z.projectpath,B);k.readFile(M,(N,O)=>{return N?void y(404,{},`do not find ${M}`):void y(200,{},O)})}else{z.appname.toLowerCase(),z.appid.toLowerCase();let M=z.hash,N;try{N=o.getAppConfigJSONSync(z)}catch(Q){return y(200,{},''),void setTimeout(()=>{let S,R=Q.type;R===b?S=t.parseJsonParseErr(Q):R===d?S=t.parseJsonFileErr(Q):R===f?S=t.parseJsonEntranceErr(Q):R===g&&(S=t.parseJsonContentErr(Q)),s.showWeappError(Q.type,S)},200)}let O=q.getProjectConfig(z);N.projectConfig=O,N.appserviceConfig=p;let P=N.pages||[];if(C){let Q=require('./tpl/appserviceTpl.js'),R=`http://${M}.appservice.open.weixin.qq.com/`,S=[],T=[],U=[];o.getAllJSFileList(z,(V,W)=>{let X={};for(let Y=0,Z=P.length;Y<Z;Y++){let $=`${P[Y]}.js`;X[$]=!0,S.push(`<script>__wxRoute = '${P[Y]}';__wxRouteBegin = true</script>`),S.push(`<script src="${R}${$}"></script>`),S.push(`<script>
              if(__wxRouteBegin) {
                console.group("${new Date} page 编译错误")
                console.error(\` ${P[Y]} 出现脚本错误或者未正确调用 Page()\`)
                console.groupEnd()
              }
              </script>`)}for(let Y=0,Z=W.length;Y<Z;Y++){let $=W[Y];X[$]||('app.js'===$?U.push(`<script src="${R}${$}"></script>`):T.push(`<script src="${R}${$}"></script>`))}S=T.concat(U).concat(S),a?(S.unshift(`<script src="${R}app_service_engine.js"></script>`),S.unshift(`<script src="${R}reporter-sdk.js"></script>`),S.unshift(`<script src="${R}appservice-sdk.js"></script>`),S.unshift(`<script src="${R}webnode.js"></script>`)):S.unshift(`<script src="${R}WAService.js"></script>`),S.unshift(`<script src="${R}asdebug.js"></script>`),N.app_nickname=z.app_nickname||z.appname,N.appname=z.appname,N.appid=z.appid,N.apphash=z.hash,N.isTourist=z.isTourist,N.platform='devtools',z.isTourist&&(N.userInfo=r.getUserInfo()),N.urlCheck=z.urlCheck,S.unshift(`<script>var __wxConfig = ${JSON.stringify(N)}</script>`),Q=Q.replace('<script></script>',S.join('')),y(null,{},Q)})}else{let Q=x.replace(`http://${M}.appservice.open.weixin.qq.com/`,'');o.getScripts({project:z,fileName:Q,needRequire:'app.js'===Q||-1!==P.indexOf(Q.replace(/\.js/,''))},(R,S)=>{if(!R)y(null,{'Content-Type':'text/javascript; charset=UTF-8'},S);else if(!S)R.project=z,s.showWeappError(R.type,t.parseJsFileErr(R)),y(200,{},'');else{let T={file:R.sourceFileName,msg:R.e};y(null,{[c]:encodeURIComponent(JSON.stringify(T))},S)}})}}},_exports.getLocalIdResponse=function(x,y){if(u.isAppTmpPath(x)){let z=u.getRealPath(x);k.readFile(z,(A,B)=>{A?y(404,{'Weapp-Error':encodeURIComponent(A)},A.toString()):y(null,{},B)})}else y(404,{},`do not find ${x}`)},_exports.getResponse=function(x,y){h.getResponse(x,y)}}init(),module.exports=_exports;