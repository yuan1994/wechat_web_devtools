'use strict';var _exports;function init(){function a(k,l,m){let n=k.split('\n'),o=0<l-3?l-3:0,p=m?[m]:[];for(let q=o;q<l;q++){let r=q==l-1?'>':' ';p.push(`${r} ${q+1} | ${n[q]}`)}return p}const b=require('path'),c=require('fs'),d=require('../../config/config.js'),f=require('../../lib/jsonlint.js').parser,g=require('../../stores/projectStores.js');f.parseError=f.lexer.parseError=function(k,l){throw l};const h=d.WXML_ERROR,j=d.WXML_LOSE_ERROR;_exports={},_exports.parseWXMLRuntimeErr=k=>{let l=g.getCurrentProject(),m=k.message.replace(d.WXML_RUNTIME_ERROR,''),n=m.split(':'),o=parseInt(n[2]);if(-1!==o){let p=c.readFileSync(b.join(l.projectpath,n[0]),'utf8'),q=m.replace(`${n[0]}:${n[1]}:${n[2]}:${n[3]}:`,'').replace(/`/g,'"'),r=a(p,o,q),s='';for(let u=0;u<n[3]-1;u++)s+=' ';r.push(`  ${n[2].replace(/\d/g,' ')} | ${s}^`);let t={file:n[0],reason:q,msg:r.join('\n')};return t}},_exports.parseJsFileErr=k=>{let l=k.file.replace(/\.js$/,''),m=k.project,n=JSON.parse(c.readFileSync(b.join(m.projectpath,'app.json'),'utf8')),o=n.pages,p=o.findIndex(q=>{return q==l});return{file:l,msg:` app.json.pages\n > | pages[${p}] : ${o[p]}`}},_exports.parseJsonContentErr=k=>{return{file:k.file,msg:k.data}},_exports.parseJsonEntranceErr=k=>{let l=JSON.parse(k.data),m=l.pages;return{file:k.file,msg:`未找到入口页面\napp.json 中定义的 pages : ${JSON.stringify(m)}`}},_exports.parseJsonFileErr=k=>{return{file:k.file,msg:'\u672A\u627E\u5230\u5165\u53E3 app.json \u6587\u4EF6\uFF0C\u6216\u8005\u6587\u4EF6\u8BFB\u53D6\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u540E\u91CD\u65B0\u7F16\u8BD1\u3002'}},_exports.parseJsonParseErr=k=>{let l=k.data;k.e;try{f.parse(l)}catch(m){let n=`Expecting ${m.expected}, got ${m.token}`,o=a(l,m.line,n),p='',q=m.loc;for(let r=0;r<q.last_column;r++)p+=' ';return o.push(`  ${m.line.toString().replace(/\d/g,' ')} | ${p}^`),k.msg=o.join('\n'),delete k.data,delete k.e,k}return k.msg=k.e.toString(),k},_exports.parseWxmlErr=(k,l)=>{let m=(l||'').trim().split(':');try{if(m.length){let n=b.join(k.projectpath,m[0]);c.readFileSync(n,'utf8').split('\n');let o=parseInt(m[1]),p=a(c.readFileSync(n,'utf8'),o,m[3]),q='';for(let s=0;s<m[2]-1;s++)q+=' ';p.push(`  ${m[1].replace(/\d/g,' ')} | ${q}^`);let r={file:m[0],msg:p};return`${h}${encodeURIComponent(JSON.stringify(r))}`}}catch(n){return l}},_exports.parseWxmlLoseErr=(k,l)=>{let m=l.match(/(\d.*?)\:/),n=m[1],o=JSON.parse(l.replace(m[0],'')),p=`未找到 ${o.pages[n]}.wxml 文件 \n > ${n} ${o.pages[n]}`;return`${j}${encodeURIComponent(p)}`},_exports.parseWxssErr=k=>{let{msg:l}=k,m=g.getCurrentProject();try{l=l.split('\n')[0];let n=l.match(/ERR:\s(.+)\((\d*):(\d*)\):\s*?(.+)/),o=parseInt(n[2]),p=n[4].replace(/`/g,'"'),q=n[1],r=c.readFileSync(b.join(m.projectpath,q),'utf8'),s=a(r,o,p),t='';for(let w=0;w<n[3]-1;w++)t+=' ';s.push(`  ${n[2].replace(/\d/g,' ')} | ${t}^`);let u={file:q,reason:p,msg:s.join('\n')};return u}catch(n){}}}init(),module.exports=_exports;