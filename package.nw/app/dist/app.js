'use strict';const tools=require('../dist/utils/tools.js'),Win=nw.Window.get();global.Win=Win,global.appConfig=tools.getAppConfig(),global.contentDocument=document,global.contentDocumentBody=document.body,global.contentWindow=window;function init(){const a=require('../dist/lib/react.js'),b=require('../dist/lib/react-dom.js'),c=require('../dist/common/loadInit/init.js'),d=require('../dist/components/ContainController.js'),e=require('../dist/common/proxy/startProxy.js'),f=require('../dist/actions/windowActions.js'),g=require('../dist/actions/webviewActions.js'),h=require('../dist/stores/webviewStores.js'),i=require('../dist/common/log/log.js'),j=require('../dist/common/shortCut/shortCut.js');let k=global.appConfig.isDev;if('darwin'===process.platform){const n=require('../dist/common/menu/menu.js');nw.Window.get().menu=n}nw.App.on('open',n=>{let o=tools.getArgsURL(n);if(o){i.info(`index.js Reopen App with url: ${o}`);let p=h.getCurrentWebviewID();g.getA8keyWebview(p,{url:o,isSync:!0,from:'urlbar'})}nw.Window.get().focus()}),-1!==nw.App.argv.indexOf('inspect')&&tools.openInspectWin();let l=tools.getArgsURL(nw.App.argv);l&&(i.info(`index.js Open App with url: ${l}`),g.setInitURL(l)),j.register(),global.weinreWin={};let m;window.addEventListener('resize',()=>{m=setTimeout(()=>{clearTimeout(m),f.resize(document.body.offsetHeight)},20)}),window.addEventListener('keydown',n=>{let o=n.keyCode;123===o&&(f.changeDevtools(),n.preventDefault())}),k||window.addEventListener('contextmenu',n=>{n.preventDefault()}),Win.on('focus',()=>{f.focus(),j.register()}),Win.on('blur',()=>{f.blur(),j.unRegister()}),Win.on('navigation',(n,o,p)=>{i.info(`index.js navigation ${o} ignore`),nw.Shell.openExternal(o),p.ignore()}),Win.on('new-win-policy',(n,o,p)=>{i.info(`index.js new-win-policy ${o} ignore`),p.ignore()}),Win.on('close',()=>{i.info(`index.js close`),process.exit()}),Win.setMinimumSize(nw.App.manifest.window.width,nw.App.manifest.window.height),e(n=>{c(),i.info(`index.js init proxy with ${n} success!!`);let o=()=>{f.resize(document.body.offsetHeight),b.render(a.createElement(d,null),document.querySelector('#container'))};'complete'===document.readyState?o():window.addEventListener('load',o)})}tools.up(init);