'use strict';var ua=navigator.userAgent,webviewID=parseInt(ua.match(/webview\/(\d*)/)[1]),weapp=ua.match(/weapp\/(\d*)/),weappID=weapp?parseInt(weapp[1]):void 0;window.runtime={};var portInit=!1,postMessageInit=!1,portMsgQuery=[],postMessageQuery=[],port=window.runtime.port=chrome.runtime.connect('',{name:`webview${webviewID}`}),__msgQueue={},__id=0;function postMessageToNW(a){if(a.webviewID=webviewID,a.weappID=weappID,!portInit)return void portMsgQuery.push(a);for(__msgQueue[a.__id]=a;__msgQueue[__id];)port.postMessage(__msgQueue[__id]),delete __msgQueue[__id],__id++}function postMessageToWebPage(a){return postMessageInit?void(a.webviewID=webviewID,window.postMessage(a,'*')):void postMessageQuery.push(a)}function handleMsg(a){let b=a.command;'SHAKE_HANDS'===b&&(portInit=!0,portMsgQuery.length&&(portMsgQuery.forEach(c=>{postMessageToNW(c)}),portMsgQuery=[]))}function receiveMessageFromPageFrame(a){'backgroundjs'===a.to&&postMessageToNW(a)}port.onMessage.addListener(a=>{let b=a.to;'contentscript'===b?handleMsg(a):'webframe'===b?postMessageToWebPage(a):'appservice'===b&&postMessageToWebPage(a)}),window.addEventListener('message',a=>{let b=a.data;if(b&&'object'==typeof b&&b.webviewID===webviewID){let i=b.comefrom,j=b.to;if('webframe'===i){let k=b.command;'contentscript'===j&&'SHAKE_HANDS'===k?(postMessageInit=!0,postMessageQuery.length&&(postMessageQuery.forEach(l=>{postMessageToWebPage(l)}),postMessageQuery=[])):receiveMessageFromPageFrame(b)}}});