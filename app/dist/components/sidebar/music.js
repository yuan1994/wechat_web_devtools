"use strict";function init(){var e=require("../../lib/react.js"),t=require("../../cssStr/cssStr.js"),s=require("../../stores/windowStores.js"),a=require("../../stores/projectStores.js"),i=(require("../../actions/windowActions.js"),require("../../actions/webviewActions.js")),r=1,o=2,n=3,c=4,u=5,l=e.createClass({displayName:"Music",_initMusic:function(){var e=document.createElement("audio");document.body.appendChild(e),this.audio=e;var t=this;e.addEventListener("play",function(){t.setState({musicState:o}),i.postMessageToAS({eventName:"onMusicPlay",type:"ON_MUSIC_EVENT",data:{dataUrl:e.src}})}),e.addEventListener("pause",function(){t.audio.ended||(t.audio.error||t.setState({musicState:n}),i.postMessageToAS({eventName:"onMusicPause",type:"ON_MUSIC_EVENT",data:{dataUrl:e.src}}))}),e.addEventListener("ended",function(){t.setState({musicState:c}),i.postMessageToAS({eventName:"onMusicEnd",type:"ON_MUSIC_EVENT",data:{dataUrl:e.src}})}),e.addEventListener("error",function(s){t.setState({musicState:u}),i.postMessageToAS({eventName:"onMusicError",type:"ON_MUSIC_EVENT",data:{dataUrl:e.src,errMsg:"Error: "+e.error.code}})})},getInitialState:function(){return this._initMusic(),{showPlayer:!1,musicState:r,title:"未知",singer:"未知"}},_play:function(e){var t=this.audio;e.dataUrl&&(t.src=e.dataUrl,t.play(),t.currentTime=0),this.setState({title:e.title||"未知",singer:e.singer||"未知"})},_resume:function(e){var t=this.audio;t.paused&&t.play()},_pause:function(e){var t=this.audio;t.paused||t.pause()},_seek:function(e){var t=this.audio;t.paused||(t.currentTime=1*e.position)},_stop:function(){var e=this.audio;e.src&&(e.currentTime=e.duration)},_getMusicPlayState:function(e){var t=this.audio,s={dataUrl:t.src,duration:Math.floor(t.duration),currentPosition:Math.floor(t.currentTime),status:t.paused?0:1,downloadPercent:Math.round(100*t.buffered.end(0)/t.duration)};return e&&e(s),s},_operateMusicPlayer:function(e){"play"==e.operationType?(this._play(e),this.setState({showPlayer:!0})):"resume"==e.operationType?this._resume(e):"pause"==e.operationType?this._pause(e):"seek"==e.operationType?this._seek(e):"stop"==e.operationType&&this._stop(e)},componentDidMount:function(){s.on("GET_MUSIC_PLAY_STATE",this._getMusicPlayState),s.on("BODY_CLICK",this._bodyClick),s.on("OPERATE_MUSIC_PLAY",this._operateMusicPlayer),a.on("RESTART_PROJECT",this._stop),a.on("CLOSE_PROJECT",this._stop)},componentWillUnmount:function(){s.removeListener("GET_MUSIC_PLAY_STATE",this._getMusicPlayState),s.removeListener("BODY_CLICK",this._bodyClick),s.removeListener("OPERATE_MUSIC_PLAY",this._operateMusicPlayer),a.removeListener("RESTART_PROJECT",this._stop),a.removeListener("CLOSE_PROJECT",this._stop)},_bodyClick:function(e){this.setState({showPlayer:!1})},stop:function(e){this._stop()},_showOrHide:function(e){this.setState({showPlayer:!this.state.showPlayer}),e.stopPropagation(),e.preventDefault()},_playOrPause:function(e){this.state.musicState==n?this._resume():this._pause(),e.stopPropagation(),e.preventDefault()},render:function(){var s=this.state.musicState==o||this.state.musicState==n?{}:t.displayNone,a=this.state.showPlayer?{}:t.displayNone,i=this.state.musicState==n?{}:t.displayNone,r=this.state.musicState==o?{}:t.displayNone;return e.createElement("div",{style:s,title:"音乐控件",onClick:this._showOrHide,className:"sidebar-item"},e.createElement("i",{className:"sidebar-item-icon  sidebar-item-icon-music"}),e.createElement("label",{className:"sidebar-item-label"},"音乐"),e.createElement("div",{className:"music-card",style:a,onClick:this._playOrPause},e.createElement("div",{className:"music-card-main"},e.createElement("p",{className:"music-card-status"},"正在播放"),e.createElement("p",{className:"music-card-name"},this.state.singer," - ",this.state.title)),e.createElement("div",{className:"music-card-opr"},e.createElement("i",{className:"music-card-play-icon",style:i}),e.createElement("i",{className:"music-card-pause-icon",style:r}))))}});_exports=l}var _exports;init(),module.exports=_exports;